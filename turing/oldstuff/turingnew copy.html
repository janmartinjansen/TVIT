<!DOCTYPE html>
<html>
<head>
    <title>Raamwerk TVIT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: sans-serif;
        }

        #container {
            display: flex;
            height: 100%;
        }

        #sidebar {
            width: 200px;
            background-color: #f0f0f0;
            padding: 10px;
            border-right: 1px solid #ccc;
        }

        #content {
            flex: 1;
            padding: 20px;
        }

        .tab-buttons button {
            padding: 10px 20px;
            margin-right: 5px;
            cursor: pointer;
        }

        .tab-content {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
        }

        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }

        #codeEditorOpgave {
            height: 300px;
        }
    </style>
    <script language="javascript" type="text/javascript" src="./turing3.js"></script>
</head>
<body>
    <div id="container">
        <div id="sidebar">
        </div>
        <div id="content">
            <div id="opgave" class="opgave-content">
                <div class="tab-buttons">
                  <button onclick="openTab('opgave', 'beschrijving')">Beschrijving</button>
                  <button onclick="openTab('opgave', 'code')">Code</button>
                    <button onclick="openTabOutput('opgave')">Run</button>
                </div>
                <div id="opgave-beschrijving" class="tab-content tab active"></div>
                <div id="opgave-code" class="tab-content tab">
                    <div id="codeEditorOpgave"></div>
                </div>
                <div id="opgave-output" class="tab-content tab">
                    <div id="outputOpgave">
                  </div>
                </div>
            </div>

        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@2.0.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script language="javascript" type="text/javascript" src="./viz.js"></script>
    <script>

        let editor = ace.edit("codeEditorOpgave");

        editor.setOption("maxLines", 80);
        //editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/python");

        var outputPart       = document.getElementById("outputOpgave");
        outputPart.innerHTML = '<turing-comp></turing-comp>';
        var examples;
        //var saved_code = [];
        //var code_index = 0, cur_code = -1;

        function showContent(opgaveId) {
            //alert(opgaveId)
            //let opgaven = document.querySelectorAll('.opgave-content');
            openTab(opgaveId, 'beschrijving');

            // Voeg de Markdown-inhoud toe aan de beschrijving van de opdracht.
            //getExamples();
        }

        function openTab(opgaveId, tabId) {
            let tabs = document.querySelectorAll(`#${opgaveId} .tab`);
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(`${opgaveId}-${tabId}`).classList.add('active');
            editor.renderer.updateFull(true);
        }

        function openTabOutput(opgaveId) {
            let tabs = document.querySelectorAll(`#${opgaveId} .tab`);
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(`opgave-output`).classList.add('active');
            //var opdata = editor.getValue();
            //saved_code[code_index++] = opdata;
            //cur_code++;
            setData(editor.getValue());
        }

        function genExamples(data) {
            var filelist = '';
            data = data.trim('\n');
            examples = data.split('\n');
            for (var line of examples) {
              filelist += `<li><a href="#" onclick="getDesAndCode('${line}')">${line.split('.')[0]}</a></li>\n`
            }
            const home = `<a href="../index.html" class="button">Home</a><br>`
            var links = `<h2>Inhoudsopgave</h2><ul>${filelist}</ul>`
            document.getElementById('sidebar').innerHTML = home + links;
        }

        function getExamples() {
          fetch('examples.rm')
            .then(response => {
              if (!response.ok) {
                throw new Error('Netwerk response was niet ok');
              }
              return response.text(); // Haal de inhoud als tekst op
            })
            .then(data => {
              genExamples(data);
              getDesAndCode(examples[0]);
            })
            .catch(error => {
              console.error('Er was een probleem bij het ophalen van het bestand:', error);
            });
          }

          function getDesAndCode(name) {
            getOpgave(name.split('.')[0] + '.md');
            getCode(name);
            //openTab(opgaveId, 'beschrijving');
          }

          function getOpgave(name) {
          fetch(name)
            .then(response => {
              if (!response.ok) {
                throw new Error('Netwerk response was niet ok');
              }
              return response.text(); // Haal de inhoud als tekst op
            })
            .then(data => {
              const htmlOutputString = marked(data);
              const tempElement = document.createElement('div');
              tempElement.innerHTML = htmlOutputString;
              const codeBlocks = tempElement.querySelectorAll('pre code');
              codeBlocks.forEach(hljs.highlightElement);
              document.getElementById('opgave-beschrijving').innerHTML = tempElement.innerHTML;
            })
            .catch(error => {
              console.error('Er was een probleem bij het ophalen van het bestand:', error);
            });
          }

          function getCode(name) {
            fetch(name)
              .then(response => {
                if (!response.ok) {
                  throw new Error('Netwerk response was niet ok');
                }
                return response.text(); // Haal de inhoud als tekst op
              })
              .then(data => {
                editor.setValue(data,-1);
                setData(editor.getValue());

                //showContent('opgave');
              })
              .catch(error => {
                console.error('Er was een probleem bij het ophalen van het bestand:', error);
              });
            }

        getExamples();
        showContent('opgave');
 
 

    </script>
</body>
</html>
