<html>
  <head>
    <link rel="stylesheet" href="editor.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/ace.js" type="text/javascript" charset="utf-8"></script>
    <title>IJVM Simulator</title>
  </head>
<body onload="initWorker()">
  <script type="text/javascript">
  var worker = undefined;

  function doVB(i) {
    editor.setValue(progs[i]);
  }

  function initWorker() {
    worker = new Worker("Simulator.js");
    worker.onmessage = function(e) {
  		doResult(e.data);
  		console.log('Message received from worker' + e.data);
  	}
  }

  function doResult(action) {
    if (action[0] == 'pc') {
      var span = document.getElementById("pc");
      span.textContent = "PC = " + action[1];
    }
    else if (action[0] == 'append') {
      addOutput(action[1]);
    }
  }

  function doAction(e) {
    worker.postMessage(e);
  }

  function run() {
      let input = editor.getValue();
      //stopbtn.hidden = false;
      doAction(['run',input]);
      //stopbtn.hidden = true;
   }

   function load() {
     let input = editor.getValue();
     doResult(['pc','1'])
     doAction(['load',input]);
  }


  function step() {
    doAction(['step']);
 }

 function stop() {
   worker.terminate();
   initWorker();
}

 function clearEditor2() {
   editor2.setValue("");
 }

  function reset() {
    editor2.setValue("");
    doAction(['reset']);
  }

 function addOutput(res) {
   if (res != '')
   var  session = editor2.session
   session.insert({
     row: session.getLength(),
     column: 0
   }, "> " + res + "\n")
 }

</script>

IJVM Simulator
<p>
  <button type="button" style="width: 100px;" onclick="doVB(5)">7*(8+4)</button>
  <button type="button" style="width: 100px;" onclick="doVB(0)">Kwadraat</button>
  <button type="button" style="width: 100px;" onclick="doVB(1)">Som recursief</button>
  <button type="button" style="width: 100px;" onclick="doVB(2)">Som loop</button>
  <button type="button" style="width: 100px;" onclick="doVB(3)">GGD</button>
  <button type="button" style="width: 100px;" onclick="doVB(4)">Fibonacci</button>
  <button type="button" style="width: 100px;" onclick="doVB(6)">Hanoi</button>
  <button type="button" style="width: 100px;" onclick="doVB(7)">SelSort</button>

  <span id="description"></span>
</p>


<pre id="inputdata">

</pre>
<p>
  <button id="runbtn" type="button" style="width: 80px;" onclick="run()">Run</button>
  <button id="loadbtn" type="button" style="width: 80px;" onclick="load()">Load</button>
  <button id="stepbtn" type="button" style="width: 80px;" onclick="step()">Step</button>
  <button id="resetbtn" type="button" style="width: 80px;" onclick="reset()">Reset</button>
  <button id="clearbtn" type="button" style="width: 80px;" onclick="clearEditor2()">Clear</button>
  <button id="stopbtn" type="button" style="width: 80px;" onclick="stop()">Stop</button>
  <span id="pc"></span>

  <pre id="outdata"></pre>
</body>

<!-- Defer loading of javascript by placing these tags at the tail end of the document -->
<script language="javascript" type="text/javascript" src="./progs.js"></script>

<script type="text/javascript">
var editor = ace.edit("inputdata");
var editor2 = ace.edit("outdata",{wrap: true});
editor.setOption("minLines", 80);
editor.setAutoScrollEditorIntoView(true);
editor2.setAutoScrollEditorIntoView(true);
editor.getSession().setMode("ace/mode/haskell");
editor.setValue(progs[5]);
var stopbtn = document.getElementById("stopbtn");
var stepbtn = document.getElementById("stepbtn");
editor2.getSession().setMode("ace/mode/haskell");
</script>

</html>
